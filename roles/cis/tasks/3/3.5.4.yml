---
- name: "3.5.4 Ensure TIPC is disabled (Not Scored)"
  vars:
   modprobe_conf: /etc/modprobe.d/modprobe.conf
  block:
    - name: "verify if modprobe.conf is present"
      shell: |
        if [ ! -f "{{ modprobe_conf }}" ]; then
            if [ ! -d "/etc/modprobe.d" ]; then
                mkdir /etc/modprobe.d
            fi
            touch {{ modprobe_conf }}
        fi
    - name: "3.5.4 write TIPC setting to modprobe.conf"
      shell: |
        LINE='install tipc /bin/true'
        FILE="{{ modprobe_conf }}"
        grep -qF -- "$LINE" "$FILE" || echo "$LINE" >> "$FILE"
  tags:
    - cis
    - cis.3
    - cis.3.5
    - cis.3.5.4
    - notscored

